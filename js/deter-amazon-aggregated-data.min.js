import{buildCompositeChart}from"./build-chart.js";let totalizedDeforestationArea=null,totalizedDegradationArea=null,totalizedAlertsInfoBox=null,totalizedCustomArea=null,lineSeriesMonthly=null,ringTotalizedByState=null,rowTotalizedByClass=null,barAreaByYear=null,monthFilters=null,deforestation=null,degradation=null,temporalDimension0=null,areaGroup0=null,classDimension0=null,yearDimension0=null,ufDimension0=null,monthDimension0=null,temporalDimensionCloud=null,areaGroupCloud=null,areaUfGroupCloud=null,yearDimensionCloud=null,yearGroupCloud=null,ufDimensionCloud=null,monthDimensionCloud=null,monthDimension=null,numPolDimension=null,yearDimension=null,yearGroup=null,ufDimension=null,classDimension=null,ufGroup=null,totalDeforestationAreaGroup=null,totalDegradationAreaGroup=null,totalAlertsGroup=null,data=null,cloudData=null,_cloudSubCharts=null,_deforestationSubCharts=null,_deforestationStatus=null,_cloudStatus=null,ringPallet=null,defPallet=null,cldPallet=null,defaultHeight=null,calendarConfiguration="prodes";export function loadData(url){return new Promise((resolve,reject)=>{d3.json(url,(error,data)=>{null!=error?reject(error):resolve(data)})})}export function processCloudData(data){if(!data||!data.totalFeatures||data.totalFeatures<=0)return;let objectData=[];var numberFormat=d3.format(".2f");for(let j=0,n=data.totalFeatures;j<n;++j){let fet=data.features[j],aCloud=fet.properties.a>0?fet.properties.a:0,month=+fet.properties.m,year=+fet.properties.y;"prodes"==calendarConfiguration&&(month>=1&&month<=7&&(year=year-1+"/"+year),month>=8&&month<=12&&(year=year+"/"+(year+1))),objectData.push({year:year,month:month,a:numberFormat(aCloud),au:numberFormat(fet.properties.au),uf:fet.properties.u})}cloudData=objectData,build()}function setChartReferencies(){totalizedDeforestationArea=dc.numberDisplay("#deforestation-classes","agrega"),totalizedDegradationArea=dc.numberDisplay("#degradation-classes","agrega"),totalizedAlertsInfoBox=dc.numberDisplay("#numpolygons","agrega"),totalizedCustomArea=d3.select("#custom-classes"),ringTotalizedByState=dc.pieChart("#chart-by-state","filtra"),rowTotalizedByClass=dc.rowChart("#chart-by-class","filtra"),barAreaByYear=dc.barChart("#chart-by-year","filtra")}function build(){setChartReferencies(),buildCompositeChart(window),ringTotalizedByState.height(defaultHeight).innerRadius(10).externalRadiusPadding(30).dimension(ufDimension).group(ufGroup).title((function(d){var v=Math.abs(+parseFloat(d.value).toFixed(2));return v=localeBR.numberFormat(",1f")(v),Translation[Lang.language].area+": "+v+" "+Translation[Lang.language].unit})).label((function(d){var v=Math.abs(+parseFloat(d.value).toFixed(0));return v=localeBR.numberFormat(",1f")(v),d.key+":"+v+" "+Translation[Lang.language].unit})).ordering(dc.pluck("key")).ordinalColors(graph.ringPallet).legend(dc.legend().x(20).y(10).itemHeight(13).gap(7).horizontal(0).legendWidth(50).itemWidth(35)),ringTotalizedByState.valueAccessor((function(d){return Math.abs(+d.value.toFixed(2))})),rowTotalizedByClass.height(defaultHeight).dimension(classDimension).group(utils.snapToZero(classGroup)).title((function(d){var v=Math.abs(+parseFloat(d.value).toFixed(2));v=localeBR.numberFormat(",1f")(v);var t=Translation[Lang.language].area+": "+v+" "+Translation[Lang.language].unit;return"CORTE_SELETIVO"===d.key&&(t=Translation[Lang.language].area+": "+v+" "+Translation[Lang.language].unit+" ("+("prodes"==graph.calendarConfiguration?Translation[Lang.language].warning_class_prodes:Translation[Lang.language].warning_class)+")"),t})).label((function(d){var v=Math.abs(+parseFloat(d.value).toFixed(1));v=localeBR.numberFormat(",1f")(v);var t=utils.mappingClassNames(d.key)+": "+v+" "+Translation[Lang.language].unit;return"CORTE_SELETIVO"===d.key&&(t=utils.mappingClassNames(d.key)+"*: "+v+" "+Translation[Lang.language].unit+" ("+("prodes"==graph.calendarConfiguration?Translation[Lang.language].warning_class_prodes:Translation[Lang.language].warning_class)+")"),t})).elasticX(!0).ordinalColors(["#FF0000","#FFFF00","#FF00FF","#F8B700","#78CC00","#00FFFF","#56B2EA","#0000FF","#00FF00"]).ordering((function(d){return-d.value})).controlsUseVisibility(!0),rowTotalizedByClass.xAxis().tickFormat((function(d){var t=parseInt(d/1e3);return t=t<1?parseInt(d):t+"k"})).ticks(5),rowTotalizedByClass.filterPrinter((function(f){var l=[];return f.forEach((function(cl){l.push(utils.mappingClassNames(cl))})),l.join(",")}));let barColors=getOrdinalColorsToYears(graph.defPallet);barAreaByYear.height(defaultHeight).yAxisLabel(Translation[Lang.language].area+" ("+Translation[Lang.language].unit+")").xAxisLabel("prodes"==graph.calendarConfiguration?Translation[Lang.language].barArea_x_label_prodes:Translation[Lang.language].barArea_x_label).dimension(yearDimension).group(utils.snapToZero(yearGroup)).title((function(d){var v=Math.abs(+parseFloat(d.value).toFixed(2));return v=localeBR.numberFormat(",1f")(v),Translation[Lang.language].area+": "+v+" "+Translation[Lang.language].unit})).label((function(d){var v=Math.abs(+parseFloat(d.data.value).toFixed(0));return v=localeBR.numberFormat(",1f")(v)})).elasticY(!0).yAxisPadding("10%").x(d3.scale.ordinal()).xUnits(dc.units.ordinal).barPadding(.2).outerPadding(.1).renderHorizontalGridLines(!0).colorCalculator((function(d){for(var i=0,l=barColors.length;i<l;){if(barColors[i].key==d.key)return barColors[i].color;i++}})).margins({top:20,right:35,bottom:"prodes"==graph.calendarConfiguration?75:60,left:55}),barAreaByYear.on("renderlet.a",(function(chart){"prodes"==graph.calendarConfiguration?chart.selectAll("g.x text").attr("transform","translate(-25,18) rotate(315)"):chart.selectAll("g.x text").attr("transform","translate(-15,8) rotate(315)")})),dc.chartRegistry.list("filtra").forEach((function(c,i){c.on("filtered",(function(chart,filter){var filters=chart.filters(),commonFilterFunction=function(d){for(var i=0;i<filters.length;i++){var f=filters[i];if(f.isFiltered&&f.isFiltered(d))return!0;if(f<=d&&f>=d)return!0}return!1};if("chart-by-year"==chart.anchorName()&&(filters.length?(graph.yearDimension0.filterFunction(commonFilterFunction),graph.yearDimensionCloud.filterFunction(commonFilterFunction)):(graph.yearDimension0.filterAll(),graph.yearDimensionCloud.filterAll())),"chart-by-state"==chart.anchorName()&&(filters.length?(graph.ufDimension0.filterFunction(commonFilterFunction),graph.ufDimensionCloud.filterFunction(commonFilterFunction)):(graph.ufDimension0.filterAll(),graph.ufDimensionCloud.filterAll())),"chart-by-class"==chart.anchorName())if(filters.length){var eqDef=!0,eqDeg=!0;filters.forEach(f=>{graph.deforestation.includes(f)||(eqDef=!1),graph.degradation.includes(f)||(eqDeg=!1)}),eqDef=!!eqDef&&filters.length==graph.deforestation.length,eqDeg=!!eqDeg&&filters.length==graph.degradation.length,eqDef&&!eqDeg?utils.highlightClassFilterButtons("deforestation"):!eqDef&&eqDeg?utils.highlightClassFilterButtons("degradation"):utils.highlightClassFilterButtons("custom"),graph.classDimension0.filterFunction(commonFilterFunction)}else graph.classDimension0.filterAll();dc.redrawAll("agrega"),graph.displayCustomValues()}))})),utils.renderAll(),graph.filterByClassGroup("deforestation"),utils.attachListenersToLegend()}