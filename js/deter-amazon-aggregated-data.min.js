import{displayGraphContainer,displayWaiting,displayWarning,fakeMonths,highlightClassFilterButtons}from"./deter-amazon-aggregated-utils.js";export function loadData(url){return new Promise((resolve,reject)=>{d3.json(url,(error,data)=>{null!=error?reject(error):resolve(data)})})}export function processCloudData(data,calendarConfiguration){if(!data||!data.totalFeatures||data.totalFeatures<=0)return;let objectData=[];var numberFormat=d3.format(".2f");for(let j=0,n=data.totalFeatures;j<n;++j){let fet=data.features[j],aCloud=fet.properties.a>0?fet.properties.a:0,month=+fet.properties.m,year=+fet.properties.y;"prodes"==calendarConfiguration&&(month>=1&&month<=7&&(year=year-1+"/"+year),month>=8&&month<=12&&(year=year+"/"+(year+1))),objectData.push({year:year,month:month,a:numberFormat(aCloud),au:numberFormat(fet.properties.au),uf:fet.properties.u})}return objectData}export function processData(data,calendarConfiguration){if(data&&data.totalFeatures&&!(data.totalFeatures<=0)){setUpdatedDate(data.updated_date),displayGraphContainer();for(var objectData=[],numberFormat=d3.format(".2f"),j=0,n=data.totalFeatures;j<n;++j){var fet=data.features[j],month=+fet.properties.m,year=+fet.properties.y;"prodes"==calendarConfiguration?(month>=1&&month<=7&&(year="20"+(year-1)+"/20"+year),month>=8&&month<=12&&(year="20"+year+"/20"+(year+1))):year="20"+year,objectData.push({year:year,month:month,area:+numberFormat(fet.properties.ar),uf:fet.properties.uf,className:fet.properties.cl,numPol:fet.properties.np})}return displayWaiting(!1),objectData}displayWarning(!0)}export function registerDataOnCrossfilter(context){var ndx0=crossfilter(context.deforData),ndx1=crossfilter(context.deforData),cloud=crossfilter(context.cloudData);let temporalDimensionCloud=cloud.dimension(d=>{var m=fakeMonths(d.month,context.calendarConfiguration);return[d.year,m]}),areaUfGroupCloud=temporalDimensionCloud.group().reduceSum(d=>+d.au),areaGroupCloud=temporalDimensionCloud.group().reduceSum(d=>+d.a),yearDimensionCloud=cloud.dimension(d=>d.year),yearGroupCloud=yearDimensionCloud.group().reduceSum(d=>d.au),ufDimensionCloud=cloud.dimension(d=>d.uf),monthDimensionCloud=cloud.dimension(d=>{var m;return fakeMonths(d.month,context.calendarConfiguration)}),monthDimension=ndx1.dimension(d=>{var m;return fakeMonths(d.month)}),temporalDimension0=ndx0.dimension(d=>{var m=fakeMonths(d.month);return[d.year,m]}),areaGroup0=temporalDimension0.group().reduceSum(d=>d.area),yearDimension0=ndx0.dimension(d=>d.year),yearGroup0=yearDimension0.group().reduceSum(d=>d.area),ufDimension0=ndx0.dimension(d=>d.uf),classDimension0=ndx0.dimension(d=>{d.className}),monthDimension0=ndx0.dimension(d=>{var m;return fakeMonths(d.month)}),numPolDimension=ndx1.dimension(d=>d.numPol),yearDimension=ndx1.dimension(d=>d.year),yearGroup=yearDimension.group().reduceSum(d=>d.area),ufDimension=ndx1.dimension(d=>d.uf),ufGroup=ufDimension.group().reduceSum(d=>d.area),classDimension=ndx1.dimension(d=>d.className),classGroup=classDimension.group().reduceSum(d=>d.area),totalDeforestationAreaGroup=classDimension0.groupAll().reduce((p,v)=>(context.deforestation.includes(v.className)&&(++p.n,p.tot+=v.area),p),(p,v)=>(context.deforestation.includes(v.className)&&(--p.n,p.tot-=v.area),p),()=>({n:0,tot:0})),totalDegradationAreaGroup=classDimension0.groupAll().reduce((p,v)=>(context.degradation.includes(v.className)&&(++p.n,p.tot+=v.area),p),(p,v)=>(context.degradation.includes(v.className)&&(--p.n,p.tot-=v.area),p),()=>({n:0,tot:0})),totalAlertsGroup=numPolDimension.groupAll().reduce((p,v)=>(p.tot+=v.numPol,p),(p,v)=>(p.tot-=v.numPol,p),()=>({tot:0}));return{temporalDimensionCloud:temporalDimensionCloud,areaUfGroupCloud:areaUfGroupCloud,areaGroupCloud:areaGroupCloud,yearDimensionCloud:yearDimensionCloud,yearGroupCloud:yearGroupCloud,ufDimensionCloud:ufDimensionCloud,monthDimensionCloud:monthDimensionCloud,monthDimension:monthDimension,temporalDimension0:temporalDimension0,areaGroup0:areaGroup0,yearDimension0:yearDimension0,yearGroup0:yearGroup0,ufDimension0:ufDimension0,classDimension0:classDimension0,monthDimension0:monthDimension0,numPolDimension:numPolDimension,yearDimension:yearDimension,yearGroup:yearGroup,ufDimension:ufDimension,ufGroup:ufGroup,classDimension:classDimension,classGroup:classGroup,totalDeforestationAreaGroup:totalDeforestationAreaGroup,totalDegradationAreaGroup:totalDegradationAreaGroup,totalAlertsGroup:totalAlertsGroup,deforestation:context.deforestation,degradation:context.degradation}}function setUpdatedDate(updated_date){var dt=new Date(updated_date+"T21:00:00.000Z");d3.select("#updated_date").html(" "+dt.toLocaleDateString())}export function filterByClassGroup(ref,context,chartReferencies){highlightClassFilterButtons(ref,chartReferencies),console.log(chartReferencies.rowTotalizedByClass.filterAll()),chartReferencies.rowTotalizedByClass.filterAll(),"deforestation"==ref?context.deforestation.forEach(cl=>{chartReferencies.rowTotalizedByClass.filter(cl)}):"degradation"==ref&&context.degradation.forEach(cl=>{chartReferencies.rowTotalizedByClass.filter(cl)}),dc.redrawAll("filtra")}